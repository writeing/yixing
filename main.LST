C51 COMPILER V9.03   MAIN                                                                  08/05/2015 15:44:19 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND OBJECT(.\output\main.obj)

line level    source

   1          /***********************************
   2          8-5号
   3          因为用arduino电脑经常蓝屏，怀疑的串口的原因，所以放弃arduino，专用stm15w开发，并且传送到git上面，
   4          
   5          
   6          
   7          
   8          ************************************/
   9          #include <STC15F2K60S2.H>
  10          #include "wifi.h"
  11          #define uint unsigned int
  12          #define uchar unsigned char
  13          /*****************************************/
  14          uchar ssid[]={"ih"};
  15          uchar passwd[]={"yixing123456"};
  16          uchar IPAddress[]={"192,168,1,104"};
  17          uint Port=5000;
  18          uchar RemoteIP[4]={0};
  19          char GetCmd[]={"GET / HTTP/1.1\r\nHost: 192.168.1.104\r\nUser-Agent: abc\r\nConnection: close\r\n"};
  20          char PostCmd[]={"POST / HTTP/1.1\r\nHost: 192.168.1.104\r\nUser-Agent: abc\r\nContent-type: text/plain\r\n
             -Content-Length:10\r\n\r\nabcdefghij\r\nConnection: close\r\n"};
  21          
  22          
  23          /*****************************************/
  24          #define CWJAP 1
  25          #define CWMODE 2
  26          #define CWQAP 3
  27          #define CIPSTART 4
  28          #define CIPSEND 5
  29          #define CIPMODE 6
  30          #define CIPCLOSE 7
  31          
  32          
  33          /**************************
  34          函数名称：
  35          函数作用：
  36          函数参数：
  37          函数备注：
  38          ***************************/
  39          /**************************
  40          函数名称:sendCmd
  41          函数作用：发送wifi参数
  42          函数参数：cmd
  43          函数备注：
  44          ***************************/
  45          int sendCmd(uint cmd)
  46          {
  47   1              switch(cmd)
  48   1              {
  49   2                      case 1:
  50   2                      WifiSend("AT+CWJAP=\"ih\",\"yixing123456\"");
  51   2                              break;
  52   2                      case 2:
  53   2                      WifiSend("AT+CWMODE=3");
  54   2                      WifiSend("AT+RST");
C51 COMPILER V9.03   MAIN                                                                  08/05/2015 15:44:19 PAGE 2   

  55   2                              break;
  56   2                      case 3:
  57   2                      WifiSend("AT+CWQAP");
  58   2                              break;
  59   2                      case 4:
  60   2                      WifiSend("AT+CIPSTART=\"TCP\",\"192.168.1.104\",5000");
  61   2                              break;
  62   2                      case 5:
  63   2                      WifiSend("AT+CIPSEND");
  64   2                              break;
  65   2                      case 6:
  66   2                      WifiSend("AT+CIPMODE=1");
  67   2                              break;
  68   2                      case 7:
  69   2                      WifiSend("AT+CIPCLOSE");
  70   2                              break;
  71   2                      default :WifiSend("AT+RST"); 
  72   2              }
  73   1              return 0;
  74   1      }
  75          /**************************
  76          函数名称:sendDate
  77          函数作用：发送wifi数据
  78          函数参数：cmd
  79          函数备注：
  80          ***************************/
  81          char sendDate(uint cmd)
  82          {
  83   1              switch(cmd)
  84   1              {
  85   2                      case 1:
  86   2                      WifiSend(GetCmd);
  87   2                              break;
  88   2                      case 2:         
  89   2                      WifiSend(PostCmd);
  90   2                              break;
  91   2                      default :WifiSend("AT+RST"); 
  92   2              }
  93   1              return '0';
  94   1      }
  95          /**************************
  96          函数名称：delay()
  97          函数作用：延时
  98          函数参数：延时时间，单位 秒
  99          函数备注：
 100          ***************************/
 101          void delay(uint time)
 102          {
 103   1              uint y=0;
 104   1              while(time--)
 105   1              {
 106   2                      y=250;
 107   2                      while(y--);
 108   2              }
 109   1      }
 110          
 111          int main()
 112          {
 113   1              int i=0,t;
 114   1              UartInit();
 115   1              while(1)
 116   1              {
C51 COMPILER V9.03   MAIN                                                                  08/05/2015 15:44:19 PAGE 3   

 117   2                      for(i=0;i<7;i++)
 118   2                      {
 119   3                              t=sendCmd(i);
 120   3                              delay(10000);   
 121   3                      }
 122   2                      sendDate(1);
 123   2                      delay(10000);                   
 124   2                      sendDate(2);
 125   2                      delay(10000);   
 126   2              }
 127   1              return 0;
 128   1      }
 129          
 130          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    280    ----
   CONSTANT SIZE    =    132    ----
   XDATA SIZE       =    244       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
